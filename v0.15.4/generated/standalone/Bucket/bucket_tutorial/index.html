<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction to the Land Bucket Model · ClimaLand.jl</title><meta name="title" content="Introduction to the Land Bucket Model · ClimaLand.jl"/><meta property="og:title" content="Introduction to the Land Bucket Model · ClimaLand.jl"/><meta property="twitter:title" content="Introduction to the Land Bucket Model · ClimaLand.jl"/><meta name="description" content="Documentation for ClimaLand.jl."/><meta property="og:description" content="Documentation for ClimaLand.jl."/><meta property="twitter:description" content="Documentation for ClimaLand.jl."/><script data-outdated-warner src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="ClimaLand.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">ClimaLand.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><a class="tocitem" href="../../../../getting_started/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Running land simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1-1" type="checkbox" checked/><label class="tocitem" for="menuitem-3-1-1"><span class="docs-label">Bucket LSM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Introduction to the Land Bucket Model</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Simulating-a-standalone-bucket-model"><span>Simulating a standalone bucket model</span></a></li><li class="toplevel"><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../coupled_bucket/">Setting up a Coupled Simulation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">Integrated soil+canopy modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../integrated/soil_canopy_tutorial/">Coupled Canopy and Soil</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-3" type="checkbox"/><label class="tocitem" for="menuitem-3-1-3"><span class="docs-label">Handling interactions between model components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../integrated/handling_soil_fluxes/">Adjusting boundary conditions for the soil</a></li><li><a class="tocitem" href="../../../integrated/handling_snow_fluxes/">Adjusting boundary conditions for the snow</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Running standalone component simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-2-1" type="checkbox"/><label class="tocitem" for="menuitem-3-2-1"><span class="docs-label">Soil modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Soil/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../Soil/richards_equation/">Richards Equation</a></li><li><a class="tocitem" href="../../Soil/soil_energy_hydrology/">Energy and Hydrology</a></li><li><a class="tocitem" href="../../Soil/freezing_front/">Phase Changes</a></li><li><a class="tocitem" href="../../Soil/layered_soil/">Layered Soil</a></li><li><a class="tocitem" href="../../Soil/evaporation/">Coarse Sand Evaporation</a></li><li><a class="tocitem" href="../../Soil/evaporation_gilat_loess/">Gilat Loess Evaporation</a></li><li><a class="tocitem" href="../../Soil/sublimation/">Bare soil site</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2-2"><span class="docs-label">Canopy modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Canopy/canopy_tutorial/">Standalone Canopy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2-3" type="checkbox"/><label class="tocitem" for="menuitem-3-2-3"><span class="docs-label">Snow Modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Snow/base_tutorial/">Seasonal Snow Timeseries Generation with a Neural Network</a></li><li><a class="tocitem" href="../../Snow/data_tutorial/">Scraping SNOTEL Data</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Calibrating your ClimaLand model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../calibration/minimal_working_example/">Single site perfect model</a></li><li><a class="tocitem" href="../../../calibration/minimal_working_example_obs/">Single site observations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">For model developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Usage/model_tutorial/">Intro to standalone models</a></li><li><a class="tocitem" href="../../Usage/LSM_single_column_tutorial/">Intro to multi-component models</a></li><li><a class="tocitem" href="../../Usage/domain_tutorial/">Intro to ClimaLand Domains</a></li><li><a class="tocitem" href="../../../shared_utilities/driver_tutorial/">Intro to forced site-level runs</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Standalone models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Vegetation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1-1"><span class="docs-label">Radiative transfer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/vegetation/radiative_transfer/beer_model/">Beer model</a></li><li><a class="tocitem" href="../../../../standalone/pages/vegetation/radiative_transfer/twostream_model/">Two-Stream model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-2" type="checkbox"/><label class="tocitem" for="menuitem-4-1-2"><span class="docs-label">Photosynthesis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/vegetation/photosynthesis/farquhar_model/">Farquhar model</a></li><li><a class="tocitem" href="../../../../standalone/pages/vegetation/photosynthesis/optimality_model/">Optimality model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-3" type="checkbox"/><label class="tocitem" for="menuitem-4-1-3"><span class="docs-label">Stomatal conductance</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/vegetation/stomatal_conductance/medlyn_model/">Medlyn model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-4" type="checkbox"/><label class="tocitem" for="menuitem-4-1-4"><span class="docs-label">Plant hydraulics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/vegetation/plant_hydraulics/van_genuchten_model/">Van Genuchten model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1"><span class="docs-label">Biogeochemistry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/soil/biogeochemistry/DAMM_model/">DAMM model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2-2"><span class="docs-label">Hydrology</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/soil/hydrology/richards_model/">Richards model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-3" type="checkbox"/><label class="tocitem" for="menuitem-4-2-3"><span class="docs-label">Energy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/soil/energy/energy_model/">Energy model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Snow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/snow/snow_model/">Snow model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">SurfaceWater</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../standalone/pages/surface_water/surface_water_model/">Surface water model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../diagnostics/users_diagnostics/">For users</a></li><li><a class="tocitem" href="../../../../diagnostics/developers_diagnostics/">For developers</a></li><li><a class="tocitem" href="../../../../diagnostics/available_diagnostics/">Available diagnostics</a></li></ul></li><li><a class="tocitem" href="../../../../restarts/">Restarts</a></li><li><a class="tocitem" href="../../../../Contributing/">Contribution guide</a></li><li><a class="tocitem" href="../../../../folderstructure/">Repository structure</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-1" type="checkbox"/><label class="tocitem" for="menuitem-9-1"><span class="docs-label">ClimaLand</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/ClimaLand/">ClimaLand</a></li><li><a class="tocitem" href="../../../../APIs/shared_utilities/">Shared Utilities</a></li><li><input class="collapse-toggle" id="menuitem-9-1-3" type="checkbox"/><label class="tocitem" for="menuitem-9-1-3"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Soil/">Soil Energy and Hydrology</a></li><li><a class="tocitem" href="../../../../APIs/SoilBiogeochemistry/">Soil Biogeochemistry</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-9-1-4" type="checkbox"/><label class="tocitem" for="menuitem-9-1-4"><span class="docs-label">Canopy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/canopy/Canopy/">Canopy Models</a></li><li><a class="tocitem" href="../../../../APIs/canopy/PlantHydraulics/">Plant Hydraulics</a></li><li><a class="tocitem" href="../../../../APIs/canopy/Photosynthesis/">Canopy Photosynthesis</a></li><li><a class="tocitem" href="../../../../APIs/canopy/RadiativeTransfer/">Canopy RT</a></li><li><a class="tocitem" href="../../../../APIs/canopy/CanopyEnergy/">Canopy Energy</a></li><li><a class="tocitem" href="../../../../APIs/canopy/StomatalConductance/">Canopy Stomatal Conductance</a></li><li><a class="tocitem" href="../../../../APIs/canopy/AutotrophicRespiration/">Canopy Autotrophic Respiration</a></li></ul></li><li><a class="tocitem" href="../../../../APIs/SurfaceWater/">Surface Water Models</a></li><li><a class="tocitem" href="../../../../APIs/Bucket/">Bucket Model</a></li><li><a class="tocitem" href="../../../../APIs/Snow/">Snow Model</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Running land simulations</a></li><li><a class="is-disabled">Bucket LSM</a></li><li class="is-active"><a href>Introduction to the Land Bucket Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction to the Land Bucket Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaLand.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaLand.jl/../../../../.." title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Introduction-to-the-Land-Bucket-Model"><a class="docs-heading-anchor" href="#Introduction-to-the-Land-Bucket-Model">Introduction to the Land Bucket Model</a><a id="Introduction-to-the-Land-Bucket-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction-to-the-Land-Bucket-Model" title="Permalink"></a></h1><p>The land bucket model implemented in ClimaLand is based off of the models of Manabe (1969)[1], Milly and Shmakin (2002)[2], and the SLIM model (Laguë, Bonan, Swann 2019)[3], with small changes, as noted.</p><p>This tutorial explains in brief the core equations and the necessary parameters of the bucket model, and shows how to set up a simulation in standalone mode. More detail for coupled runs can be found in the ClimaCoupler.jl <a href="https://clima.github.io/ClimaCoupler.jl/dev/">documentation</a> and in the coupled simulation <a href="https://clima.github.io/ClimaLand.jl/dev/generated/coupled_bucket/">tutorial</a>.</p><p>At each coordinate point on the surface, we solve ordinary differential equations for the subsurface water storage of land (<code>W</code>, m), the snow water equivalent multiplied by the snow cover fraction (<code>σS</code>, m), and the surface water content of land (<code>Ws</code>, m). We additionally solve a partial differential equation for the land temperature as a function of depth (<code>T</code>, K). The snow cover fraction is given by a heaviside function in the current code.</p><p>In what follows, surface fluxes over <code>soil</code> generally indicate fluxes over non-snow-covered regions. The exception is the albedo of vegetated and non-vegetated surfaces, for which we use the symbol <code>α_sfc</code>.</p><p>All equation variables are defined immediately below. We have:</p><p><span>$\frac{d W}{dt} = -I,$</span></p><p><span>$\frac{d Ws}{dt} = -(P_{liq} + σM + (1-σ) E_{soil} - I),$</span></p><p><span>$\frac{d σS}{dt} = -(P_{snow} + σE_{snow} - σM),$</span></p><p><span>$ρc \frac{\partial T}{\partial t} = κ_{soil} \frac{\partial T}{\partial z}$</span></p><p><span>$F_{bot} = 0.0 = -κ_{soil} \frac{\partial T}{\partial z}|_{z = z_{bot}}$</span></p><p><span>$(1-σ) (R_n+ SHF + LHF)_{soil} + σG_{undersnow} = -κ_{soil} \frac{\partial T}{\partial z}|_{z = z_{sfc}}$</span></p><p><span>$G_{undersnow} = (R_n+ SHF + LHF)_{snow} - F_{intosnow}$</span></p><p><span>$F_{intosnow} = -ρ_l L_{f,0} (P_{snow} + E_{snow}-M)$</span></p><p><span>$R_n = -(1-α)*SW↓ -LW↓ + σ_{SB} T_{sfc}^4$</span></p><p>where the water fluxes are : <code>I</code> the infiltration as defined in [1], <code>P_liq</code> (m/s) the water volume flux of precipitation, <code>P_snow</code> (m/s) the water volume flux in the form of snow, <code>(1-σ)E_soil</code> (m/s) the water volume flux in evaporation, <code>σE_snow</code> the water volume flux in sublimation from snow, and <code>σM</code> (m/s) the water volume flux in melting of snow. The melt rate is defined via the net surface flux when surface temperatures are above freezing. All fluxes are defined to be positive if towards the atmosphere (cooling land or decreasing water mass in land) and negative if towards land (warming land or increasing water mass). Hence the melting flux is negative since it warms land, and precipitation fluxes are negative since they increase water mass on land.</p><p>For heat fluxes, we have <code>R_n</code> the net radiation, <code>SHF</code> the sensible heat flux, <code>LHF</code> the latent heat flux, <code>G_undersnow</code> the heat flux into snow-covered soil, and <code>F_intosnow</code> the heat flux into the snowpack itself. Note that the water balance equation for snow is equivalent to the heat balance equation, since we neglect the sensible heat contribution and only track the latent heat contribution. We neglect the energy in liquid precipitation.</p><p>Finally, we have <code>α_bareground_func(lat, lon)</code> the (snow-free) surface albedo, <code>ρc</code> the volumetric heat capacity of the land, <code>σ_SB</code> the Stefan-Boltzmann constant,  and <code>κ_soil</code> the thermal conductivity. The albedo is a linear interpolation between the albedo of surface and snow, as decribed in [3]. The surface temperature is taken to be equal to the temperature T at the first grid point, assumed to be the same for soil and snow. At present the snow cover fraction is a heaviside function, and only one set of surface fluxes is computed per grid point.</p><p>Turbulent surface fluxes of sensible heat, latent heat, and water vapor (<code>SHF, LHF, E</code>) are computed using Monin-Obukhov theory; <code>SW↓</code> and <code>LW↓</code> are the downward fluxes in short and long wavelength bands. We use the same roughness lengths for snow and soil. Note that with the exception of precipitation and downwelling radiation, all fluxes are defined such that positive is towards the atmosphere.</p><p>As the temperature at the surface of the soil and snow is the same, only the evaporation changes between the two surface coverage types. We have</p><p><span>$E_{soil} =  β(W, W_f) E(q_{sat}(T_{sfc}, ρ_{sfc}; liquid),$</span></p><p>where β is the factor used in [1] which accounts for the fact that soil does not evaporate at the potential rate when it is not saturated. This makes use of the field capacity parameter <code>W_f</code>. We also have</p><p><span>$E_{snow} = E(q_{sat}(T_{sfc}, ρ_{sfc}; ice).$</span></p><h1 id="Simulating-a-standalone-bucket-model"><a class="docs-heading-anchor" href="#Simulating-a-standalone-bucket-model">Simulating a standalone bucket model</a><a id="Simulating-a-standalone-bucket-model-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-a-standalone-bucket-model" title="Permalink"></a></h1><p>First, we need to import necessary packages. We use <a href="https://github.com/SciML/SciMLBase.jl">SciMLBase.jl</a> and <a href="https://github.com/CliMA/ClimaTimeSteppers.jl">ClimaTimeSteppers.jl</a> for the timestepping.</p><pre><code class="language-julia hljs">import SciMLBase
import ClimaTimeSteppers as CTS</code></pre><p>We use <a href="https://github.com/CliMA/ClimaCore.jl">ClimaCore</a> for setting up the domain/coordinate points. While this infrastructure isn&#39;t really necessary for standalone simulations, adhering to it makes setting up coupled simulations very easy. It also is nice to rely on ClimaCore utilities because they have been designed in advance for running distributed simulations.</p><pre><code class="language-julia hljs">using ClimaCore</code></pre><p>We also use ClimaParams, which strives to ensure a common set of parameters across all Clima models, and to make parameter estimation more seamless.</p><pre><code class="language-julia hljs">import ClimaParams as CP</code></pre><p>We also use Insolation to calculate solar zenith angle and solar insolation.</p><p>Lastly, let&#39;s bring in the bucket model types (from ClimaLand) that we will need access to.</p><pre><code class="language-julia hljs">using ClimaLand.Bucket:
    BucketModel, BucketModelParameters, PrescribedBaregroundAlbedo
using ClimaLand.Domains: coordinates, Column
using ClimaLand:
    initialize,
    make_update_aux,
    make_exp_tendency,
    make_set_initial_cache,
    PrescribedAtmosphere,
    PrescribedRadiativeFluxes
using ClimaUtilities.TimeVaryingInputs: TimeVaryingInput</code></pre><p>We also want to plot the solution</p><pre><code class="language-julia hljs">using Plots</code></pre><p>And we need to use the DateTime type to store start dates</p><pre><code class="language-julia hljs">using Dates

FT = Float32;</code></pre><p>As mentioned we use ClimaParams for earth parameters that are required across models (e.g. the density of water and ice, the latent heat of fusion at a reference temperature, etc). The land model requires additional parameters as described in the text above. These two sets are combined in the object <code>BucketModelParameters</code> as follows:</p><pre><code class="language-julia hljs">import ClimaLand
import ClimaLand.Parameters as LP
earth_param_set = LP.LandParameters(FT);</code></pre><p>Set up the model domain. At every surface coordinate point, we&#39;ll solve an ODE for <code>W</code> and <code>Ws</code>, and for every subsurface point, we solve for <code>T</code>. In coupled simulations run at the same resolution as the atmosphere, the bucket horizontal resolution would match the horizontal resolution at the lowest level of the atmosphere model. In general, however, the two resolutions do not need to match. Here we just set up something simple - a Column.</p><pre><code class="language-julia hljs">soil_depth = FT(3.5);
bucket_domain = Column(; zlim = (-soil_depth, FT(0.0)), nelements = 10);
surface_space = bucket_domain.space.surface</code></pre><pre><code class="nohighlight hljs">ClimaCore.Spaces.PointSpace{ClimaComms.SingletonCommsContext{ClimaComms.CPUSingleThreaded}, ClimaCore.DataLayouts.DataF{ClimaCore.Geometry.LocalGeometry{(3,), ClimaCore.Geometry.ZPoint{Float32}, Float32, StaticArraysCore.SMatrix{1, 1, Float32, 1}}, SubArray{Float32, 1, Matrix{Float32}, Tuple{Int64, Base.Slice{Base.OneTo{Int64}}}, true}}}(ClimaComms.SingletonCommsContext{ClimaComms.CPUSingleThreaded}(ClimaComms.CPUSingleThreaded()), ClimaCore.DataLayouts.DataF{ClimaCore.Geometry.LocalGeometry{(3,), ClimaCore.Geometry.ZPoint{Float32}, Float32, StaticArraysCore.SMatrix{1, 1, Float32, 1}}, SubArray{Float32, 1, Matrix{Float32}, Tuple{Int64, Base.Slice{Base.OneTo{Int64}}}, true}}
  Float32[0.0, 0.35, 0.175, 2.85714, 0.35, 2.85714, 8.16327, 0.1225])</code></pre><p>Define our <code>PrescribedBaregroundAlbedo</code> model using a constant bareground surface and snow albedo: The bareground albedo is a function of coordinates, which would be (x,y) on a plane, and (lat,lon) on a sphere. It is also an option to supply a netcdf file with the bareground albedo.</p><pre><code class="language-julia hljs">α_bareground_func = (coordinate_point) -&gt; 0.2;
α_snow = FT(0.8);
albedo =
    PrescribedBaregroundAlbedo{FT}(α_snow, α_bareground_func, surface_space);</code></pre><p>The critical snow level setting the scale for when we interpolate between snow and surface albedo</p><pre><code class="language-julia hljs">σS_c = FT(0.2);</code></pre><p>The field capacity of the soil</p><pre><code class="language-julia hljs">W_f = FT(0.15);</code></pre><p>Roughness lengths (meters)</p><pre><code class="language-julia hljs">z_0m = FT(1e-2);
z_0b = FT(1e-3);</code></pre><p>Thermal parameters of soil</p><pre><code class="language-julia hljs">κ_soil = FT(0.7);
ρc_soil = FT(2e6);</code></pre><p>Snow melt timescale</p><pre><code class="language-julia hljs">τc = FT(3600);</code></pre><p>Simulation start date, end time, and timestep</p><pre><code class="language-julia hljs">t0 = 0.0;
tf = 7 * 86400;
Δt = 3600.0;

bucket_parameters = BucketModelParameters(FT; albedo, z_0m, z_0b, τc);</code></pre><p>The PrescribedAtmosphere and PrescribedRadiation need to take in a reference time, the date of the start of the simulation. In this tutorial we will consider this January 1, 2005.</p><pre><code class="language-julia hljs">start_date = DateTime(2005);</code></pre><p>To drive the system in standalone mode, the user must provide prescribed functions of time for the water volume flux in precipitation,  for the net downward shortwave and longwave radiative energy fluxes (<code>SW↓, LW↓</code>, W/m^2), for the atmospheric temperature <code>T_a</code>, wind speed <code>u_a</code> (m/s), specific humidity <code>q_a</code>, and air density <code>ρ_a</code> (kg/m^3) at a reference height <code>h_a</code> (m).</p><p>Here we define the model drivers Prescribed atmospheric variables</p><p>Precipitation:</p><pre><code class="language-julia hljs">precip = (t) -&gt; 0;
snow_precip = (t) -&gt; -5e-7 * (t &gt; 3 * 86400) * (t &lt; 4 * 86400);</code></pre><p>Diurnal temperature variations:</p><pre><code class="language-julia hljs">T_atmos = (t) -&gt; 275.0 + 5.0 * sin(2.0 * π * t / 86400 - π / 2);</code></pre><p>Constant otherwise:</p><pre><code class="language-julia hljs">u_atmos = (t) -&gt; 3.0;
q_atmos = (t) -&gt; 0.005;
h_atmos = FT(2);
P_atmos = (t) -&gt; 101325;</code></pre><p>We need to warp all these objects in TimeVaryingInputs (this is because in general PrescribedAtmosphere could take numerical data)</p><pre><code class="language-julia hljs">bucket_atmos = PrescribedAtmosphere(
    TimeVaryingInput(precip),
    TimeVaryingInput(snow_precip),
    TimeVaryingInput(T_atmos),
    TimeVaryingInput(u_atmos),
    TimeVaryingInput(q_atmos),
    TimeVaryingInput(P_atmos),
    start_date,
    h_atmos,
    earth_param_set,
);</code></pre><p>Prescribed radiation – a prescribed downwelling SW diurnal cycle, with a peak at local noon, and a prescribed downwelling LW radiative flux, assuming the air temperature is on average 275 degrees K with a diurnal amplitude of 5 degrees K:</p><pre><code class="language-julia hljs">SW_d = (t) -&gt; @. max(1361 * sin(2π * t / 86400 - π / 2));
LW_d = (t) -&gt; 5.67e-8 * (275.0 + 5.0 * sin(2.0 * π * t / 86400 - π / 2))^4;
bucket_rad = PrescribedRadiativeFluxes(
    FT,
    TimeVaryingInput(SW_d),
    TimeVaryingInput(LW_d),
    start_date,
);</code></pre><p>Then, we create the model object, which contains the drivers, parameters, domain, and is associated with the correct differential equations for the bucket model:</p><pre><code class="language-julia hljs">model = BucketModel(
    parameters = bucket_parameters,
    domain = bucket_domain,
    atmosphere = bucket_atmos,
    radiation = bucket_rad,
);</code></pre><p>Note the holder structs for the radiation and atmosphere functions: they are named <code>Prescribed</code>. In coupled simulations, we would use a different type and rely on multiple dispatch to obtain the atmospheric and radiative quantitites from the coupler.</p><p>Like all ClimaLand models, we set up the state vector using <code>initialize</code>:</p><pre><code class="language-julia hljs">Y, p, coords = initialize(model);</code></pre><p>We can inspect the prognostic and auxiliary variables of the model:</p><pre><code class="language-julia hljs">ClimaLand.prognostic_vars(model)
Y.bucket |&gt; propertynames</code></pre><pre><code class="nohighlight hljs">(:W, :T, :Ws, :σS)</code></pre><p>The auxiliary variables in this case are the surface temperature, the turbulent fluxes, the net radiation, and the surface specific humidity.</p><pre><code class="language-julia hljs">ClimaLand.auxiliary_vars(model)
p.bucket |&gt; propertynames</code></pre><pre><code class="nohighlight hljs">(:q_sfc, :turbulent_fluxes, :R_n, :T_sfc, :α_sfc, :ρ_sfc, :snow_cover_fraction, :F_sfc, :partitioned_fluxes, :G, :snow_melt, :infiltration, :top_bc_wvec)</code></pre><p>Next is to set initial conditions.</p><pre><code class="language-julia hljs">Y.bucket.T .= FT(270);
Y.bucket.W .= FT(0.05);
Y.bucket.Ws .= FT(0.0);
Y.bucket.σS .= FT(0.08);</code></pre><p>We also set the initial values of the cache here:</p><pre><code class="language-julia hljs">set_initial_cache! = make_set_initial_cache(model);
set_initial_cache!(p, Y, t0);</code></pre><p>Then to create the entire right hand side (tendency) function for the system of ordinary differential equations:</p><pre><code class="language-julia hljs">exp_tendency! = make_exp_tendency(model);</code></pre><p>Now we choose our timestepping algorithm.</p><pre><code class="language-julia hljs">timestepper = CTS.RK4()
ode_algo = CTS.ExplicitAlgorithm(timestepper)</code></pre><pre><code class="nohighlight hljs">ClimaTimeSteppers.IMEXAlgorithm{ClimaTimeSteppers.Unconstrained, ClimaTimeSteppers.RK4, ClimaTimeSteppers.IMEXTableau{ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}, ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}, ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}}, Nothing}(ClimaTimeSteppers.Unconstrained(), ClimaTimeSteppers.RK4(), ClimaTimeSteppers.IMEXTableau{ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}, ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}, ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}, ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}}(ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}([0.0 0.0 0.0 0.0; 0.5 0.0 0.0 0.0; 0.0 0.5 0.0 0.0; 0.0 0.0 1.0 0.0]), ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}([0.16666666666666666, 0.3333333333333333, 0.3333333333333333, 0.16666666666666666]), ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}([0.0, 0.5, 0.5, 1.0]), ClimaTimeSteppers.SparseCoeffs{(4, 4), (true, false, true, true, true, true, false, true, true, true, true, false, true, true, true, true), StaticArraysCore.SMatrix{4, 4, Float64, 16}}([0.0 0.0 0.0 0.0; 0.5 0.0 0.0 0.0; 0.0 0.5 0.0 0.0; 0.0 0.0 1.0 0.0]), ClimaTimeSteppers.SparseCoeffs{(4,), (false, false, false, false), StaticArraysCore.SVector{4, Float64}}([0.16666666666666666, 0.3333333333333333, 0.3333333333333333, 0.16666666666666666]), ClimaTimeSteppers.SparseCoeffs{(4,), (true, false, false, false), StaticArraysCore.SVector{4, Float64}}([0.0, 0.5, 0.5, 1.0])), nothing)</code></pre><p>Then we can set up the simulation and solve it:</p><pre><code class="language-julia hljs">prob = SciMLBase.ODEProblem(
    CTS.ClimaODEFunction(T_exp! = exp_tendency!, dss! = ClimaLand.dss!),
    Y,
    (t0, tf),
    p,
);</code></pre><p>We need a callback to get and store the auxiliary fields, as they are not stored by default. We also need a callback to update the drivers (atmos and radiation)</p><pre><code class="language-julia hljs">saveat = collect(t0:Δt:tf);
saved_values = (;
    t = Array{Float64}(undef, length(saveat)),
    saveval = Array{NamedTuple}(undef, length(saveat)),
);
saving_cb = ClimaLand.NonInterpSavingCallback(saved_values, saveat);
updateat = copy(saveat)
model_drivers = ClimaLand.get_drivers(model)
updatefunc = ClimaLand.make_update_drivers(model_drivers)
driver_cb = ClimaLand.DriverUpdateCallback(updateat, updatefunc)
cb = SciMLBase.CallbackSet(driver_cb, saving_cb)

sol = SciMLBase.solve(prob, ode_algo; dt = Δt, saveat = saveat, callback = cb);</code></pre><p>Extracting the solution from what is returned by the ODE.jl commands is a bit clunky right now, but we are working on hiding some of this. <code>parent</code> extracts the underlying data from the ClimaCore.Fields.Field object and we loop over the solution <code>sol</code> because of how the data is stored within solutions returned by ODE.jl - indexed by timestep.</p><pre><code class="language-julia hljs">W = [parent(sol.u[k].bucket.W)[1] for k in 1:length(sol.t)];
Ws = [parent(sol.u[k].bucket.Ws)[1] for k in 1:length(sol.t)];
σS = [parent(sol.u[k].bucket.σS)[1] for k in 1:length(sol.t)];
T_sfc =
    [parent(saved_values.saveval[k].bucket.T_sfc)[1] for k in 1:length(sol.t)];
evaporation = [
    parent(saved_values.saveval[k].bucket.turbulent_fluxes.vapor_flux)[1]
    for k in 1:length(sol.t)
];
R_n = [parent(saved_values.saveval[k].bucket.R_n)[1] for k in 1:length(sol.t)];</code></pre><p>The turbulent energy flux is the sum of latent and sensible heat fluxes.</p><pre><code class="language-julia hljs">LHF = [
    parent(saved_values.saveval[k].bucket.turbulent_fluxes.lhf)[1] for
    k in 1:length(sol.t)
];
SHF = [
    parent(saved_values.saveval[k].bucket.turbulent_fluxes.shf)[1] for
    k in 1:length(sol.t)
];
turbulent_energy_flux = SHF .+ LHF

plot(
    sol.t ./ 86400,
    W,
    label = &quot;&quot;,
    xlabel = &quot;time (days)&quot;,
    ylabel = &quot;W (m)&quot;,
    title = &quot;Land water storage (m)&quot;,
)
savefig(&quot;w.png&quot;)</code></pre><pre><code class="nohighlight hljs">&quot;/home/runner/work/ClimaLand.jl/ClimaLand.jl/docs/src/generated/standalone/Bucket/w.png&quot;</code></pre><p><img src="../w.png" alt/></p><pre><code class="language-julia hljs">plot(
    sol.t ./ 86400,
    σS,
    label = &quot;&quot;,
    xlabel = &quot;time (days)&quot;,
    ylabel = &quot;σS (m)&quot;,
    title = &quot;Area weighted SWE (m) &quot;,
)
savefig(&quot;swe.png&quot;)</code></pre><pre><code class="nohighlight hljs">&quot;/home/runner/work/ClimaLand.jl/ClimaLand.jl/docs/src/generated/standalone/Bucket/swe.png&quot;</code></pre><p><img src="../swe.png" alt/></p><pre><code class="language-julia hljs">plot(
    sol.t ./ 86400,
    snow_precip.(sol.t),
    label = &quot;Net precipitation&quot;,
    xlabel = &quot;time (days)&quot;,
    ylabel = &quot;Flux (m/s)&quot;,
    title = &quot;Surface water fluxes&quot;,
    legend = :bottomright,
)
plot!(sol.t ./ 86400, evaporation, label = &quot;Sublimation/Evaporation&quot;)
savefig(&quot;water_f.png&quot;)</code></pre><pre><code class="nohighlight hljs">&quot;/home/runner/work/ClimaLand.jl/ClimaLand.jl/docs/src/generated/standalone/Bucket/water_f.png&quot;</code></pre><p><img src="../water_f.png" alt/></p><pre><code class="language-julia hljs">plot(
    sol.t ./ 86400,
    T_sfc,
    title = &quot;Surface Temperatures&quot;,
    label = &quot;Ground temperature&quot;,
    xlabel = &quot;time (days)&quot;,
    ylabel = &quot;T_sfc (K)&quot;,
    legend = :bottomright,
)
plot!(sol.t ./ 86400, T_atmos.(sol.t), label = &quot;Atmospheric Temperature&quot;)
savefig(&quot;t.png&quot;)</code></pre><pre><code class="nohighlight hljs">&quot;/home/runner/work/ClimaLand.jl/ClimaLand.jl/docs/src/generated/standalone/Bucket/t.png&quot;</code></pre><p><img src="../t.png" alt/></p><pre><code class="language-julia hljs">plot(
    sol.t ./ 86400,
    R_n,
    label = &quot;Net radiative flux&quot;,
    xlabel = &quot;time (days)&quot;,
    ylabel = &quot;Flux (W/m^2)&quot;,
    title = &quot;Surface energy fluxes&quot;,
    legend = :bottomright,
)
plot!(sol.t ./ 86400, turbulent_energy_flux, label = &quot;Turbulent fluxes&quot;)
plot!(sol.t ./ 86400, R_n .+ turbulent_energy_flux, label = &quot;Net flux&quot;)
savefig(&quot;energy_f.png&quot;)</code></pre><pre><code class="nohighlight hljs">&quot;/home/runner/work/ClimaLand.jl/ClimaLand.jl/docs/src/generated/standalone/Bucket/energy_f.png&quot;</code></pre><p><img src="../energy_f.png" alt/></p><h1 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h1><p>[1] Manabe, S. (1969) CLIMATE AND THE OCEAN CIRCULATION I: The Atmospheric Circulation and the Hydrology of the Earth&#39;s Surface. Monthly Weather Review, Volume 97: Issue 11, p 739-774. [2] Milly, P. C. D. and Shmakin, A.B. (2002) Global Modeling of Land Water and Energy Balances. Part I: The Land Dynamics (LaD) Model Journal of Hydrometeorology, Volume 3: Issue 3, p 283-299. [3] Laguë, M., Bonan, G., and Swann, A. (2019) Seperating the Impact of Individual Land Surface Properties on the Terrestrial Surface Energy Budget in both the Coupled and Uncoupled Land-Atmosphere System Volume 32: Issue 18, p 5725-5744</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../../getting_started/">« Getting Started</a><a class="docs-footer-nextpage" href="../coupled_bucket/">Setting up a Coupled Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Tuesday 29 October 2024 19:22">Tuesday 29 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
