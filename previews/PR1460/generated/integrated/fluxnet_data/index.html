<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Data processing · ClimaLand.jl</title><meta name="title" content="Data processing · ClimaLand.jl"/><meta property="og:title" content="Data processing · ClimaLand.jl"/><meta property="twitter:title" content="Data processing · ClimaLand.jl"/><meta name="description" content="Documentation for ClimaLand.jl."/><meta property="og:description" content="Documentation for ClimaLand.jl."/><meta property="twitter:description" content="Documentation for ClimaLand.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="ClimaLand.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">ClimaLand.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../getting_started/">Running your first simulation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Running standalone component simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Bucket/bucket_tutorial/">Bucket</a></li><li><input class="collapse-toggle" id="menuitem-3-1-2" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Soil/boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../../standalone/Soil/richards_equation/">Richards Equation</a></li><li><a class="tocitem" href="../../standalone/Soil/soil_energy_hydrology/">Energy and Hydrology</a></li><li><input class="collapse-toggle" id="menuitem-3-1-2-4" type="checkbox"/><label class="tocitem" for="menuitem-3-1-2-4"><span class="docs-label">Phase Changes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Soil/freezing_front/">Modeling a freezing front in unsaturated soil</a></li><li><a class="tocitem" href="../../standalone/Soil/phase_change_analytic/">The Stefan problem</a></li></ul></li><li><a class="tocitem" href="../../standalone/Soil/layered_soil/">Layered Soil</a></li><li><a class="tocitem" href="../../standalone/Soil/evaporation/">Coarse Sand Evaporation</a></li><li><a class="tocitem" href="../../standalone/Soil/evaporation_gilat_loess/">Gilat Loess Evaporation</a></li><li><a class="tocitem" href="../../standalone/Soil/sublimation/">Bare soil site</a></li><li><a class="tocitem" href="../../standalone/Soil/changing_soil_parameterizations/">Changing soil parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-3" type="checkbox"/><label class="tocitem" for="menuitem-3-1-3"><span class="docs-label">Canopy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Canopy/default_canopy/">Default canopy</a></li><li><a class="tocitem" href="../../standalone/Canopy/canopy_tutorial/">Default canopy fluxtower simulation </a></li><li><a class="tocitem" href="../../standalone/Canopy/changing_canopy_parameterizations/">Changing canopy parameterizations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-1-4" type="checkbox"/><label class="tocitem" for="menuitem-3-1-4"><span class="docs-label">Snow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Snow/base_tutorial/">Base tutorial</a></li><li><a class="tocitem" href="../../standalone/Snow/data_tutorial/">Data tutorial</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Running Fluxnet simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../soil_canopy_fluxnet_tutorial/">Canopy and soil</a></li><li><a class="tocitem" href="../snowy_land_fluxnet_tutorial/">Canopy, soil, and snow</a></li><li><a class="tocitem" href="../changing_snowy_land_parameterizations/">Changing LandModel parameterizations</a></li><li class="is-active"><a class="tocitem" href>Data processing</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Fluxnet-comparison-data"><span>Fluxnet comparison data</span></a></li></ul></li><li><a class="tocitem" href="../fluxnet_vis/">Visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Running global simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../global/bucket/">Bucket</a></li><li><a class="tocitem" href="../../global/snowy_land/">Snow, soil, canopy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Calibrating a ClimaLand model</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../calibration/perfect_model_site_level_calibration/">Single site perfect model</a></li><li><a class="tocitem" href="../../calibration/obs_site_level_calibration/">Single site observations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Running coupled simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Bucket/coupled_bucket/">Coupled bucket model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">For model developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Usage/model_tutorial/">Intro to standalone models</a></li><li><input class="collapse-toggle" id="menuitem-3-6-2" type="checkbox"/><label class="tocitem" for="menuitem-3-6-2"><span class="docs-label">Intro to multi-component models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../standalone/Usage/LSM_single_column_tutorial/">Single column tutorial</a></li><li><a class="tocitem" href="../handling_soil_fluxes/">Adjusting boundary conditions for the soil</a></li><li><a class="tocitem" href="../handling_snow_fluxes/">Adjusting boundary conditions for the snow</a></li></ul></li><li><a class="tocitem" href="../../standalone/Usage/domain_tutorial/">Intro to ClimaLand Domains</a></li><li><a class="tocitem" href="../../shared_utilities/driver_tutorial/">Intro to forced site-level runs</a></li><li><a class="tocitem" href="../../shared_utilities/timestepping/">Intro to implicit/explicit timestepping</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Model Equations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Vegetation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1-1"><span class="docs-label">Radiative transfer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/vegetation/radiative_transfer/beer_model/">Beer model</a></li><li><a class="tocitem" href="../../../standalone/pages/vegetation/radiative_transfer/twostream_model/">Two-Stream model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-2" type="checkbox"/><label class="tocitem" for="menuitem-4-1-2"><span class="docs-label">Photosynthesis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/vegetation/photosynthesis/farquhar_model/">Farquhar model</a></li><li><a class="tocitem" href="../../../standalone/pages/vegetation/photosynthesis/pmodel/">P-model</a></li><li><a class="tocitem" href="../../../standalone/pages/vegetation/photosynthesis/optimality_model/">Optimality model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-3" type="checkbox"/><label class="tocitem" for="menuitem-4-1-3"><span class="docs-label">Stomatal conductance</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/vegetation/stomatal_conductance/medlyn_model/">Medlyn model</a></li><li><a class="tocitem" href="../../../standalone/pages/vegetation/photosynthesis/pmodel/">P-model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-1-4" type="checkbox"/><label class="tocitem" for="menuitem-4-1-4"><span class="docs-label">Plant hydraulics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/vegetation/plant_hydraulics/van_genuchten_model/">Van Genuchten model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1"><span class="docs-label">Physics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/soil/physics/richards_model/">Richards model</a></li><li><a class="tocitem" href="../../../standalone/pages/soil/physics/energy_model/">Energy+Hydrology model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2-2"><span class="docs-label">Biogeochemistry</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/soil/biogeochemistry/DAMM_model/">DAMM model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Snow</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../standalone/pages/snow/snow_model/">Snow model</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Additional resources</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../model_structure/">Model structure</a></li><li><a class="tocitem" href="../../../repo_structure/">Repository structure</a></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Analyzing model output</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-3-1" type="checkbox"/><label class="tocitem" for="menuitem-5-3-1"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../diagnostics/users_diagnostics/">For users</a></li><li><a class="tocitem" href="../../../diagnostics/developers_diagnostics/">For developers</a></li><li><a class="tocitem" href="../../../diagnostics/available_diagnostics/">Available diagnostics</a></li></ul></li><li><a class="tocitem" href="../../../leaderboard/leaderboard/">Leaderboard</a></li></ul></li><li><a class="tocitem" href="../../../architectures/">Running on GPU or with MPI</a></li><li><a class="tocitem" href="../../../calibration/">Calibration</a></li><li><a class="tocitem" href="../../../restarts/">Restarting a simulation</a></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Software utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../itime/">ITime type</a></li><li><a class="tocitem" href="../../../shared_utilities/">Shared utilities</a></li></ul></li><li><a class="tocitem" href="../../../physical_units/">Physical units</a></li><li><a class="tocitem" href="../../../julia/">Julia background</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Soil/">Soil Energy and Hydrology</a></li><li><a class="tocitem" href="../../../APIs/SoilBiogeochemistry/">Soil Biogeochemistry</a></li><li><a class="tocitem" href="../../../APIs/SoilAlbedo/">Soil Albedo</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Canopy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/canopy/Canopy/">Canopy Models</a></li><li><a class="tocitem" href="../../../APIs/canopy/PlantHydraulics/">Plant Hydraulics</a></li><li><a class="tocitem" href="../../../APIs/canopy/Biomass/">Leaf, stem, root dynamics</a></li><li><a class="tocitem" href="../../../APIs/canopy/Photosynthesis/">Photosynthesis</a></li><li><a class="tocitem" href="../../../APIs/canopy/RadiativeTransfer/">Radiative Transfer</a></li><li><a class="tocitem" href="../../../APIs/canopy/CanopyEnergy/">Energy</a></li><li><a class="tocitem" href="../../../APIs/canopy/StomatalConductance/">Stomatal Conductance</a></li><li><a class="tocitem" href="../../../APIs/canopy/AutotrophicRespiration/">Autotrophic Respiration</a></li></ul></li><li><a class="tocitem" href="../../../APIs/SurfaceWater/">Surface Water Models</a></li><li><a class="tocitem" href="../../../APIs/Bucket/">Bucket Model</a></li><li><a class="tocitem" href="../../../APIs/Snow/">Snow Model</a></li><li><a class="tocitem" href="../../../APIs/ClimaLand/">Integrated Models</a></li><li><input class="collapse-toggle" id="menuitem-6-7" type="checkbox"/><label class="tocitem" for="menuitem-6-7"><span class="docs-label">Shared Utilities</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/AbstractModels/">Abstract Models and Functions</a></li><li><a class="tocitem" href="../../../APIs/Simulations/">Simulations</a></li><li><a class="tocitem" href="../../../APIs/Domains/">Domains</a></li><li><a class="tocitem" href="../../../APIs/Drivers/">Drivers</a></li><li><a class="tocitem" href="../../../APIs/Callbacks/">Callbacks</a></li></ul></li><li><a class="tocitem" href="../../../APIs/parameters/">Parameters</a></li></ul></li><li><a class="tocitem" href="../../../contributing/">Contributor guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Running Fluxnet simulations</a></li><li class="is-active"><a href>Data processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Data processing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaLand.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaLand.jl/../../../.." title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Fluxnet-forcing-data:-LAI,-radiation,-and-atmospheric-variables"><a class="docs-heading-anchor" href="#Fluxnet-forcing-data:-LAI,-radiation,-and-atmospheric-variables">Fluxnet forcing data: LAI, radiation, and atmospheric variables</a><a id="Fluxnet-forcing-data:-LAI,-radiation,-and-atmospheric-variables-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxnet-forcing-data:-LAI,-radiation,-and-atmospheric-variables" title="Permalink"></a></h1><p>In this tutorial, we will demonstrate how we read in forcing data at a Fluxnet site using our ClimaLand infrastructure. To see an example running a simulation at a Fluxnet site, please see the corresponding tutorials for the <a href="docs/src/tutorials/integrated/soil_canopy_fluxnet_tutorial.jl">SoilCanopyModel</a> or <a href="docs/src/tutorials/integrated/snowy_land_fluxnet_tutorial.jl">LandModel</a> To access the forcing data (LAI from MODIS, SW_d, LW_d, T_air, q_air, P_air, and precipitation from fluxtower data), you first need the the fluxtower site ID. Currently, ClimaLand provides an interface for working with four fluxtower sites; adding support for a much larger set of sites is in progress. The sites we support are Vaira Ranch (US_Var), Missouri Ozark (US-MOz), Niwot Ridge (US-NR1), and Harvard Forest (US-Ha1).</p><pre><code class="language-julia hljs">using Dates
import ClimaParams as CP
using ClimaLand
using ClimaLand.Domains: Column
import ClimaLand.Parameters as LP
using DelimitedFiles
using CairoMakie
import ClimaLand.FluxnetSimulations as FluxnetSimulations</code></pre><p>Define the floating point precision desired (64 or 32 bit), and get the parameter set holding constants used across CliMA Models.</p><pre><code class="language-julia hljs">const FT = Float32;
toml_dict = LP.create_toml_dict(FT)</code></pre><pre><code class="nohighlight hljs">ParamDict{Float32} with 633 parameters</code></pre><p>Pick a site ID; convert the dash to an underscore:</p><pre><code class="language-julia hljs">site_ID = &quot;US-NR1&quot;;
site_ID_val = FluxnetSimulations.replace_hyphen(site_ID)</code></pre><pre><code class="nohighlight hljs">:US_NR1</code></pre><p>The functions we use below use multiple dispatch, treating the site<em>ID</em>val as a Julia type.</p><p>First, we need the latitude and longitude of the site. These are used to get the zenith angle as a function of time, and to look up default parameters using the global ClimaLand parameter maps. We also need the offset of the local time of the site in hours from UTC. This is because ClimaLand simulations are carried out in UTC, while the fluxtower data is reported in local time.</p><pre><code class="language-julia hljs">(; time_offset, lat, long) =
    FluxnetSimulations.get_location(FT, Val(site_ID_val))</code></pre><pre><code class="nohighlight hljs">(time_offset = -7, lat = 40.0329f0, long = -105.5464f0)</code></pre><p>ClimaLand also needs to know the height at which the atmospheric data was recorded.</p><pre><code class="language-julia hljs">(; atmos_h) = FluxnetSimulations.get_fluxtower_height(FT, Val(site_ID_val))</code></pre><pre><code class="nohighlight hljs">(atmos_h = 21.5f0,)</code></pre><p>It is also useful to know the bounds of the data, in UTC, to use as the start and stop date of the simulation.</p><pre><code class="language-julia hljs">(start_date, stop_date) =
    FluxnetSimulations.get_data_dates(site_ID, time_offset)</code></pre><pre><code class="nohighlight hljs">(Dates.DateTime(&quot;2010-01-01T07:15:00&quot;), Dates.DateTime(&quot;2011-01-01T06:45:00&quot;))</code></pre><p>Now we can construct the forcing objects. Under the hood, this function finds the local path to the fluxtower data (and downloads it if it is not present) and reads the data in. It then creates two objects, one called <code>atmos</code>, of type <code>PrescibedAtmosphere</code>, and one called <code>radiation</code>, of type <code>PrescribedRadiativeFluxes</code>. These encode the data in interpolating functions which allow us to estimate the forcing at any time during the simulation using linear interpolation across gaps in the data.</p><pre><code class="language-julia hljs">(; atmos, radiation) = FluxnetSimulations.prescribed_forcing_fluxnet(
    site_ID,
    lat,
    long,
    time_offset,
    atmos_h,
    start_date,
    toml_dict,
    FT,
);</code></pre><p>The atmosphere object holds the air temperature, pressure, specific humidity, wind speed, and liquid and solid precipitation fluxes. Since many fluxtower sites do not measure the snow and rain fluxes separately, we estimate them internally. This is optional, and by providing the kwarg <code>split_precip = false</code>, you can change the behavior to return all measured precip as a liquid water flux (no snow). The radiation object holds the downwelling short and long wave radiative fluxes. The diffuse fraction is estimated internally using an empirical function, and the zenith angle is computed analytically.</p><p>The simulation time is measured in seconds since the <code>start_date</code>. We can get the atmospheric temperature at the <code>start_date</code> as follows:</p><pre><code class="language-julia hljs">sim_time = 0.0
T = [NaN]
evaluate!(T, atmos.T, sim_time);
@show T</code></pre><pre><code class="nohighlight hljs">1-element Vector{Float64}:
 261.98999999999995</code></pre><p>Note that <code>evaluate!</code> updates <code>T</code> in place. This is important: in our simulations, we allocate memory for the forcing, and then update the values at each step. If we did not do this, the dynamic memory allocation would cause the simulation to be incredibly slow. We can plot the interpolated air temperature for the first day:</p><pre><code class="language-julia hljs">sim_times = 0.0:1800.0:86400.0 # one day in seconds
air_temps = [];
for sim_time in sim_times
    evaluate!(T, atmos.T, sim_time)
    push!(air_temps, T[1])
end
fig = CairoMakie.Figure()
ax = CairoMakie.Axis(
    fig[1, 1],
    ylabel = &quot;Temperature (K)&quot;,
    xlabel = &quot;Date&quot;,
    title = &quot;Near-surface air temperature at Niwot Ridge&quot;,
)
lines!(ax, Second.(sim_times) .+ start_date, air_temps)
CairoMakie.save(&quot;air_temp.png&quot;, fig);</code></pre><p><img src="../air_temp.png" alt/></p><p>We do something very similar with LAI, but now the data is coming from MODIS. In this case, we use nearest-neighbor interpolatation to move from the gridded MODIS data to the LAI at the latitude and longitude of the site. To do spatial interpolation, we need to create a ClimaLand domain.</p><pre><code class="language-julia hljs">domain =
    Column(; zlim = (FT(-3.0), FT(0.0)), nelements = 10, longlat = (long, lat))
surface_space = domain.space.surface;</code></pre><p>Get the paths to each year of MODIS data within the start and stop dates.</p><pre><code class="language-julia hljs">LAI =
    ClimaLand.Canopy.prescribed_lai_modis(surface_space, start_date, stop_date);</code></pre><p>Just like with the air temperature, the LAI is an object that we can use to linearly interpolate observed LAI to any simulation time.</p><p>It can also be useful to know the maximum LAI at a site. To do so, we can call, for the first year of data:</p><pre><code class="language-julia hljs">maxLAI = FluxnetSimulations.get_maxLAI_at_site(start_date, lat, long)</code></pre><pre><code class="nohighlight hljs">1.4455398f0</code></pre><h1 id="Fluxnet-comparison-data"><a class="docs-heading-anchor" href="#Fluxnet-comparison-data">Fluxnet comparison data</a><a id="Fluxnet-comparison-data-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxnet-comparison-data" title="Permalink"></a></h1><p>To assess performance of the simulation, we need comparison data from the site. This is complicated since different sites provided different data (e.g. soil moisture and temperature and depth). ClimaLand provides a function to get the comparison data for a select number of variables:</p><table><tr><th style="text-align: left">Variable</th><th style="text-align: center">Unit</th><th style="text-align: center">ClimaLand short name</th><th style="text-align: right">Fluxnet Column name</th></tr><tr><td style="text-align: left">Gross primary prod.</td><td style="text-align: center">mol/m^2/s</td><td style="text-align: center">&quot;gpp&quot;</td><td style="text-align: right">&quot;GPP_DT_VUT_REF&quot;</td></tr><tr><td style="text-align: left">Latent heat flux</td><td style="text-align: center">W/m^2/s</td><td style="text-align: center">&quot;lhf&quot;</td><td style="text-align: right">&quot;LE_CORR&quot;</td></tr><tr><td style="text-align: left">Sensible heat flux</td><td style="text-align: center">W/m^2/s</td><td style="text-align: center">&quot;shf&quot;</td><td style="text-align: right">&quot;H_CORR&quot;</td></tr><tr><td style="text-align: left">Upwelling SW</td><td style="text-align: center">W/m^2/s</td><td style="text-align: center">&quot;swu&quot;</td><td style="text-align: right">&quot;SW_OUT&quot;</td></tr><tr><td style="text-align: left">Upwelling LW</td><td style="text-align: center">W/m^2/s</td><td style="text-align: center">&quot;lwu&quot;</td><td style="text-align: right">&quot;LW_OUT&quot;</td></tr><tr><td style="text-align: left">Soil water content</td><td style="text-align: center"></td><td style="text-align: center">&quot;swc&quot;</td><td style="text-align: right">&quot;SWC_F_MDS_1&quot;</td></tr><tr><td style="text-align: left">Soil temperature</td><td style="text-align: center">K</td><td style="text-align: center">&quot;tsoil&quot;</td><td style="text-align: right">&quot;TS_F_MDS_1&quot;</td></tr><tr><td style="text-align: left">Total precipitation</td><td style="text-align: center">m/s</td><td style="text-align: center">&quot;precip&quot;</td><td style="text-align: right">&quot;P_F&quot;</td></tr></table><pre><code class="language-julia hljs">comparison_data = FluxnetSimulations.get_comparison_data(site_ID, time_offset);
@show propertynames(comparison_data)</code></pre><pre><code class="nohighlight hljs">(:UTC_datetime, :gpp, :lhf, :shf, :swu, :lwu, :swc, :tsoil, :precip)</code></pre><p>If a column is missing, the column is not returned. Missing values are replaced with the mean of the not missing values.</p><p>The data we use to force the simulations and to compare the results against were obtained from Ameriflux:</p><p>US-Moz: https://doi.org/10.17190/AMF/1854370 Citation: Jeffrey Wood, Lianhong Gu (2025), AmeriFlux FLUXNET-1F US-MOz Missouri Ozark Site, Ver. 5-7, AmeriFlux AMP, (Dataset). https://doi.org/10.17190/AMF/1854370</p><p>US-NR1: https://doi.org/10.17190/AMF/1871141 Citation: Peter D. Blanken, Russel K. Monson, Sean P. Burns, David R. Bowling, Andrew A. Turnipseed (2022), AmeriFlux FLUXNET-1F US-NR1 Niwot Ridge Forest (LTER NWT1), Ver. 3-5, AmeriFlux AMP, (Dataset). https://doi.org/10.17190/AMF/1871141</p><p>US-Var: https://doi.org/10.17190/AMF/1993904 Citation: Siyan Ma, Liukang Xu, Joseph Verfaillie, Dennis Baldocchi (2023), AmeriFlux FLUXNET-1F US-Var Vaira Ranch- Ione, Ver. 3-5, AmeriFlux AMP, (Dataset). https://doi.org/10.17190/AMF/1993904</p><p>US-Ha1: https://doi.org/10.17190/AMF/1871137 Citation: J. William Munger (2022), AmeriFlux FLUXNET-1F US-Ha1 Harvard Forest EMS Tower (HFR1), Ver. 3-5, AmeriFlux AMP, (Dataset). https://doi.org/10.17190/AMF/1871137</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../changing_snowy_land_parameterizations/">« Changing LandModel parameterizations</a><a class="docs-footer-nextpage" href="../fluxnet_vis/">Visualization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 23 September 2025 01:13">Tuesday 23 September 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
