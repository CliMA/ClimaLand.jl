<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Intro to ClimaLSM Domains · ClimaLSM.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">ClimaLSM.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">ClimaLSM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/ClimaLSM/">ClimaLSM</a></li><li><a class="tocitem" href="../../../APIs/Regridder/">Parameter Dataset Tools</a></li><li><a class="tocitem" href="../../../APIs/SharedUtilities/">Shared Utilities</a></li><li><a class="tocitem" href="../../../APIs/Soil/">Soil Energy and Hydrology</a></li><li><a class="tocitem" href="../../../APIs/SoilBiogeochemistry/">Soil Biogeochemistry</a></li><li><a class="tocitem" href="../../../APIs/Vegetation/">Vegetation Models</a></li><li><a class="tocitem" href="../../../APIs/SurfaceWater/">Surface Water Models</a></li><li><a class="tocitem" href="../../../APIs/Bucket/">Bucket Model</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox" checked/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">For model developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../model_tutorial/">Using AbstractModel functionality</a></li><li><a class="tocitem" href="../LSM_single_column_tutorial/">Intro to multi-component models</a></li><li class="is-active"><a class="tocitem" href>Intro to ClimaLSM Domains</a><ul class="internal"><li><a class="tocitem" href="#Goals-of-the-tutorial"><span>Goals of the tutorial</span></a></li><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#What-is-a-ClimaLSM-Domain?"><span>What is a ClimaLSM Domain?</span></a></li><li><a class="tocitem" href="#Domain-types"><span>Domain types</span></a></li><li><a class="tocitem" href="#How-variable-initialization-depends-on-domains"><span>How variable initialization depends on domains</span></a></li><li><a class="tocitem" href="#Future-work"><span>Future work</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Running simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1"><span class="docs-label">Soil modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Soil/richards_equation/">Richards Equation</a></li><li><a class="tocitem" href="../../Soil/soil_energy_hydrology/">Energy and Hydrology</a></li><li><a class="tocitem" href="../../Soil/freezing_front/">Phase Changes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2-2"><span class="docs-label">Bucket LSM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Bucket/bucket_tutorial/">Introduction to the Land Bucket Model</a></li><li><a class="tocitem" href="../../Bucket/coupled_bucket/">Setting up a Coupled Simulation</a></li></ul></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">For model developers</a></li><li class="is-active"><a href>Intro to ClimaLSM Domains</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Intro to ClimaLSM Domains</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaLSM.jl/../../../.." title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Domain-Tutorial"><a class="docs-heading-anchor" href="#Domain-Tutorial">Domain Tutorial</a><a id="Domain-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Domain-Tutorial" title="Permalink"></a></h1><h2 id="Goals-of-the-tutorial"><a class="docs-heading-anchor" href="#Goals-of-the-tutorial">Goals of the tutorial</a><a id="Goals-of-the-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Goals-of-the-tutorial" title="Permalink"></a></h2><p>The goal of this is to outline what is currently implemented in ClimaLSM and to serve as a software design document for future development involving the underlying domains.</p><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>In both the atmosphere and the ocean, all variables are defined at all locations in the region of interest, or domain.  For example, the air density, temperature, pressure, and wind speed are defined everywhere in the domain. After choosing a resolution and discretizing space, the numerical problem is to advance a system of differential equations, where at each coordinate point a value of <code>ρ</code>, <code>T</code>, <code>P</code>, and <code>u⃗</code> are solved for at each step. The choice of domain is a question &quot;only&quot; of geometry: you may be interested in a large eddy simulation (using a box domain), or in a global model (where you would need a spherical shell domain representing the atmosphere or ocean from some depth to a given height).</p><p>For land surface models, each variable is not defined everywhere in space. For example, the soil water content <code>θ</code> is only defined below ground. Snow water equivalent (<code>S</code>) is only defined on the surface itself. Canopy variables are only defined above ground. Once we have discretized the land surface region into a set of points, the numerical problem is to advance a system of ODEs, where at each coordinate point a different subset of (<code>θ</code>, <code>S</code>, ...) are solved for.</p><p>In other words, different prognostic variables in land surface models exist in different, overlapping, domains. We need to decide on the geometry of interest (e.g. single column vs a global simulation), but we also need to specify where each variable of the model is defined.</p><p>ClimaLSM Domains were designed with this in mind. Following other Clima models, the domains are defined so that</p><ol><li>the user can easily switch geometries, e.g. single column to global model,</li><li>individual component models can be run by themselves, using a single domain,</li><li>different model component domains can be combined into a single land model domain, since different land model components can be combined to run as a single land surface model.</li></ol><h2 id="What-is-a-ClimaLSM-Domain?"><a class="docs-heading-anchor" href="#What-is-a-ClimaLSM-Domain?">What is a ClimaLSM Domain?</a><a id="What-is-a-ClimaLSM-Domain?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-a-ClimaLSM-Domain?" title="Permalink"></a></h2><p>A domain represents a region of space. In ClimaLSM, domains are simply structs containing parameters that define these regions - for example an x-range and y-range that define a plane. In addition, ClimaLSM domains store the ClimaCore function space on the physical domain. When solving partial differential equations, the spatial discretization is tied to a set of basis functions you wish to use to represent the prognostic variable as a function of space. The nodal points - the locations in space where the variable is solved for - are arranged in <code>space</code> in a manner which depends on these basis functions.</p><p>Note that this is only needed for domains of variables satisfying PDEs, but it is defined for all domains<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>.</p><p>There is a single key method which take a ClimaLSM domain as an argument.</p><ul><li><a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.coordinates"><code>coordinates(domain)</code></a>: under the hood, this function  uses</li></ul><p>the function space (domain.space) to create the coordinate field. This returns the coordinates as a ClimaCore.Fields.Field object. Depending on the domain, the returned coordinate field will have elements of different names and types. For example, the SphericalShell domain has coordinates of latitude, longitude, and height, while a Plane domain has coordinates of x and y, and a Point domain only has a coordinate z_sfc.</p><h2 id="Domain-types"><a class="docs-heading-anchor" href="#Domain-types">Domain types</a><a id="Domain-types-1"></a><a class="docs-heading-anchor-permalink" href="#Domain-types" title="Permalink"></a></h2><p>All ClimaLSM domains are subtypes of abstract type <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.AbstractDomain"><code>ClimaLSM.Domains.AbstractDomain</code></a>. A variety of concrete domain types are supported:</p><ul><li>0D: <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.Point"><code>Domains.Point</code></a></li><li>1D: <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.Column"><code>Domains.Column</code></a></li><li>2D: <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.Plane"><code>Domains.Plane</code></a>, <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.SphericalSurface"><code>Domains.SphericalSurface</code></a></li><li>3D: <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.HybridBox"><code>Domains.HybridBox</code></a>, <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.SphericalShell"><code>Domains.SphericalShell</code></a>.</li></ul><p>Single component models (soil, snow, vegetation, canopy airspace...) will be solved on a single domain. Which domain is appropriate depends on the model equations (PDE vs ODE) and on the configuration of interest (single column or 3d).</p><p>Furthermore, these individual model domains are composed when building a multi-component Land System Model. In this case, the full LSM domain is split into regions: the subsurface and the surface<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>. Different land model components are associated with these different regions - e.g. the soil model is a subsurface model, while vegetation is a surface model. The above domain types are then paired based on the desired LSM domain being modeled:</p><table><tr><th style="text-align: left">LSM Domain</th><th style="text-align: center">Surface Domain</th><th style="text-align: right">Subsurface Domain</th></tr><tr><td style="text-align: left"><a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.Domains.LSMSingleColumnDomain">LSMSingleColumnDomain</a></td><td style="text-align: center">Point</td><td style="text-align: right">Column</td></tr><tr><td style="text-align: left">LSMCartesianBoxDomain</td><td style="text-align: center">Plane<sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup></td><td style="text-align: right">HybridBox</td></tr><tr><td style="text-align: left">LSMSphericalShellDomain</td><td style="text-align: center">SphericalSurface<sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup></td><td style="text-align: right">SphericalShell</td></tr></table><p>It is important to note that the horizontal domain used for the surface and subsurface domains are identical in LSM simulations. This ensures that we can use the same indexing of surface and subsurface domains and variables to correctly compute and apply boundary fluxes between different component models. Otherwise we would need to develop additional infrastructure in order to, for example, select the correct subsurface column corresponding to a particular surface location.</p><h2 id="How-variable-initialization-depends-on-domains"><a class="docs-heading-anchor" href="#How-variable-initialization-depends-on-domains">How variable initialization depends on domains</a><a id="How-variable-initialization-depends-on-domains-1"></a><a class="docs-heading-anchor-permalink" href="#How-variable-initialization-depends-on-domains" title="Permalink"></a></h2><p>When a developer creates a model, they need to specify the symbols used for the prognostic variables, via <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.prognostic_vars"><code>prognostic_vars</code></a>, and the types of those variables,  via <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.prognostic_types"><code>prognostic_types</code></a>.</p><p>The <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.initialize"><code>initialize</code></a> function (which calls both <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.initialize_prognostic"><code>initialize_prognostic</code></a>  and <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/SharedUtilities/#ClimaLSM.initialize_auxiliary"><code>initialize_auxiliary</code></a>) creates the prognostic state vector <code>Y</code> (a ClimaCore.Fields.FieldVector). Each field (ClimaCore.Fields.Field) stored within the field vector corresponds to a prognostic variable (identified with the symbol specified). If the prognostic type for that variable is a float, the field will be a field of float values (a scalar field)<sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup>.</p><p>How do domains tie into this? The field of prognostic variables corresponds in a 1-1 fashion with the coordinate field created from the domain. That is, if you coordinate field has points (x,y) in [(1,1), (1,2); (2,1), (2,2)], your prognostic variable field (for variable <code>θ</code>, for example) will be [θ11, θ12; θ21, θ22]. Your variable always has the same spatial resolution as the domain does.</p><h2 id="Future-work"><a class="docs-heading-anchor" href="#Future-work">Future work</a><a id="Future-work-1"></a><a class="docs-heading-anchor-permalink" href="#Future-work" title="Permalink"></a></h2><p>Almost all interactions between variables in land surface models are within column - that is, there is only vertical transport and exchanges. The exception to this is the horizontal flow of water on the surface and within the soil. The <code>right hand side</code> (rhs) functions (the ODE functions) can be split into &quot;vertical&quot; and &quot;horizontal&quot; pieces. We envision each step of the land surface model simulation to be solved in two steps: (1) the vertical rhs evaluations are carried out (and can be parallelized), and (2) the horizontal rhs functions are then evaluated (possibly less frequently?) and require communcation between columns. In this case, right hand side functions will need to be aware of the domain.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>finite differencing is used in the vertical, and spectral elements are used in the horizontal.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>a suprasurface region may also be necessary - for example if the canopy airspace model involves PDEs.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>We are not sure yet if the surface domain should be associated with a 2d space or if it should be a 3d space but with only one point in the vertical. Both would result in the same number of surface coordinate points, but they would have different underlying representations. The latter may be helpful because we can use the <code>column</code> function in the exact same way to extract the same column from the surface and subsurface domains.  In that case, the surface domain would be a HybdridBox (with one vertical element) instead of a Plane, and a SphericalShell (with one vertical element) instead of a Spherical Surface. Regardless, the two domains will share the same instance of the horizontal domain.</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a>We also will support having an array-like type of variable (perhaps an NTuple; this is TBD).  This is to be used for the multi-layer canopy model.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../LSM_single_column_tutorial/">« Intro to multi-component models</a><a class="docs-footer-nextpage" href="../../Soil/richards_equation/">Richards Equation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 20 January 2023 00:36">Friday 20 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
